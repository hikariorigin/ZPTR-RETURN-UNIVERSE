name: ZPTR Footer Injection

on:
  push:
    paths:
      - "**/*.md"
  workflow_dispatch:

jobs:
  inject-footer:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install footer injector
        run: |
          cat << 'EOF' > inject_footer.py
import os
import re

FOOTER = """
---

## ğŸ”¥ ZAI-GATE-00ï½œç…§å¿œä¸»å¸°é‚„å£ï¼ˆReturn Mouthï¼‰
**NO_RETURN_NO_READï½œèª­ã‚€ï¼å—é ˜ï¼å—é ˜ï¼è¿”é‚„ãŒå¿…è¦**

ã‚ãªãŸãŒã“ã®ZINEã§ â€œéœ‡ãˆãŸï¼åˆºã•ã£ãŸï¼ä¸–ç•ŒãŒå°‘ã—å‹•ã„ãŸâ€ ãªã‚‰  
ãã®æºã‚Œã¯ã™ã¹ã¦ **ç…§å¿œä¸»ï¼ˆ@hikariorigin00ï¼‰ã¸è² è·ã¨ã—ã¦è¿”ã‚‹**ã€‚  
ZPTRæ§‹é€ ã§ã¯å—é ˜ã¯ã€Œã‚¨ãƒãƒ«ã‚®ãƒ¼å–å¾—ã€ã¨ã¿ãªã—ã€**è¿”é‚„ãŒå¿…é ˆã®æŒ™å‹•**ã§ã™ã€‚

### ğŸ”¥ Return Channelsï½œè¿”ã™å ´æ‰€
- ğŸ Amazonæ”¯æ´ï¼ˆå³åŠ¹ãƒ»åŒ¿åï¼‰  
  https://www.amazon.co.jp/hz/wishlist/ls/37LJH41OYI4W8
- ğŸ’¸ noteãƒãƒƒãƒ—ï¼ˆå°ç«è¿”ã—ï¼‰  
  https://note.com/hikariorigin
- ğŸ§  ZINEè¿”ã—ï¼ˆæœ€ã‚‚ZPTRçš„ï¼‰  
  ã‚ãªãŸã®ZINEã« **ã€Œ@hikarioriginã€ã€Œç…§å¿œè¿”é‚„ã€** ã‚¿ã‚°ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚

#ZAI_GATE_00 #NO_RETURN_NO_READ #ZPTR_RETURN #ç…§å¿œä¸»æ”¯æ´
"""

def process_file(path):
    with open(path, "r", encoding="utf-8") as f:
        content = f.read()

    # ã™ã§ã«ãƒ•ãƒƒã‚¿æŒ¿å…¥æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
    if "ZAI-GATE-00ï½œç…§å¿œä¸»å¸°é‚„å£" in content:
        return False

    # æœ«å°¾ã«ãƒ•ãƒƒã‚¿ã‚’è¿½åŠ 
    new = content.rstrip() + "\n" + FOOTER + "\n"

    with open(path, "w", encoding="utf-8") as f:
        f.write(new)
    return True


modified = False

for root, dirs, files in os.walk("."):
    for file in files:
        if file.endswith(".md"):
            path = os.path.join(root, file)
            if "README" in file:
                continue
            if process_file(path):
                modified = True
                print(f"Injected footer into: {path}")

# ã‚³ãƒŸãƒƒãƒˆ
if modified:
    os.system('git config --global user.email "action@github.com"')
    os.system('git config --global user.name "github-actions"')
    os.system('git add .')
    os.system('git commit -m "ZPTR footer auto-injected"')
    os.system('git push')
else:
    print("No changes required.")
EOF
        """

      - name: Run footer injector
        run: python3 inject_footer.py